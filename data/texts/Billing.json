["Manual Billing & Refund Process \nIntroduction\nThis demo showcases the end-to-end billing and refund process, including account setup, quote management, tenant provisioning, invoice generation, payment processing, and flexible refund handling. It ensures accuracy, efficiency, and seamless financial operations.\nPurpose\nThe purpose is to showcase the end-to-end process of managing a comprehensive billing and refund workflow.This process ensures accuracy in billing and seamless handling of refunds u", "racy in billing and seamless handling of refunds under various scenarios.\nConcept/Overview\nThis is a streamlined flow for handling billing and refunds in a dynamic business environment. Starting from the creation of accounts, opportunities, and quotes, it demonstrates the addition of products, approval workflows, and payment processing using credit cards. The flow extends to tenant provisioning via API, manual billing operations for adding products, generating invoices, and running batch jobs fo", "ts, generating invoices, and running batch jobs for payment posting & Integration. Lastly, it emphasizes a robust refund process, enabling partial or full refunds by quantity or amount, with support for tax and surcharge scenarios. This ensures all financial transactions are efficiently managed and traceable, maintaining transparency and accuracy throughout the lifecycle.\nBilling and Refund Process Flow\n1. Account Setup \nStep 1: Create an account with necessary details. Name,Billing Address etc.", " with necessary details. Name,Billing Address etc...\nStep 2: Add a contact associated with the account.Contact Name,\nStep 3: Create an opportunity linked to the account.\nStep 4: Generate a quote under the opportunity.\n2. Quote Creation\nStep 1: Add products such as GSP and MT to the quote.\nStep 2: Set the payment method as \"Credit Card.\"\nStep 3: Verify that the payment method is correctly added.\nStep 4: Approve the quote to move forward.\n3. Tenant Provisioning\nStep 1: Add Tenant ID and Tenant Nam", " Provisioning\nStep 1: Add Tenant ID and Tenant Name to the Account.\nStep 2: Use the API to provision the tenant with the provided details.\n4. Manual Billing Page\nStep 1: Navigate to the Manual Billing page and Create Manual Invoice .\n\n\n\n\n\n\n\n\nStep 2: Add the required products for billing. (Ex: Managed Technician - PHEG Residential Starter, Managed Technician - PHEG Residential The Works)\n\n\nStep 3: Verify that the records for the added products are successfully inserted.\n\n\nStep 4: Generate an invo", " successfully inserted.\n\n\nStep 4: Generate an invoice for the added products.\n\nStep 5: Post the invoice using STCB Constants query.\nMetadata to Update: Order and Invoice https://servicetitan--uat2.sandbox.lightning.force.com/lightning/setup/CustomMetadata/page?address=%2Fm1J1P000000Gmd4 \nSELECT Id,blng__InvoiceStatus__c,blng__TotalAmount__c,blng__Account__c,blng__Balance__c,blng__Account__r.SBQQ__TaxExempt__c,Invoice_Misc_Status__c, blng__Account__r.Tenant_ID__c,blng__Account__r.Billing_Enabled_", "__r.Tenant_ID__c,blng__Account__r.Billing_Enabled__c,(SELECT Id,blng__Invoice__r.blng__Account__c,blng__Product__r.Name,blng__Product__r.ProductCode,blng__Product__r.Prepayment_Deposit__c,blng__TaxAmount__c,blng__TaxStatus__c,blng__TaxPercentageApplied__c,blng__SubTotal__c,WD_Tax_AFC__c,WD_Tax_AvaTax__c,blng__Balance__c,blng__Invoice__r.blng__InvoiceStatus__c,Sync_To_Workday__c,blng__TaxRule__r.name FROM blng__InvoiceInvoiceLines__r) FROM blng__Invoice__c WHERE blng__InvoiceStatus__c = 'Draft' A", "nvoice__c WHERE blng__InvoiceStatus__c = 'Draft' AND CreatedDate <= TODAY and (Invoice_Misc_Status__c = null or Invoice_Misc_Status__c ='Ready For Posting') AND id = 'aCldx0000001E2XCAU'\n\n\nStep 6: Running the AutoPostInvoiceBatchJob() job twice via the workbench. \nId batchId = Database.executeBatch(new STCB_AutoPostInvoiceBatchJob(), 1);\n\nStep 7: Confirming that the invoice status is updated to Posted and Unpaid.\n\n5. Payment Integration\nStep 1: Execute the payment query using STCB constants.\nhtt", "xecute the payment query using STCB constants.\nhttps://servicetitan--uat2.sandbox.lightning.force.com/lightning/setup/CustomMetadata/page?address=%2Fm1J1P000000Gmcb \nSELECT Id,blng__InvoiceStatus__c,blng__Account__c,blng__TotalAmount__c,STCB_Payment_Retry_Count__c,STCB_Payment_Attempt_Date__c,blng__PaymentStatus__c,STCB_Payment_Scheduler_Status__c,blng__Balance__c,Invoice_Long_Description__c ,STCB_Payment_Retry_Daily_Count__c,Credit_Card_Surcharge_Total__c,Credit_Card_Surcharge_Status__c FROM bl", "e_Total__c,Credit_Card_Surcharge_Status__c FROM blng__Invoice__c WHERE blng__Balance__c > 0.5 AND blng__InvoiceStatus__c = 'Posted' and blng__PaymentStatus__c != 'Paid' AND blng__PaymentBatch__c = NULL AND (STCB_Payment_Retry_Count__c = null OR STCB_Payment_Retry_Count__c <= 2) AND (STCB_Payment_Attempt_Date__c = null OR STCB_Payment_Attempt_Date__c < Today) AND STCB_Payment_Scheduler_Status__c NOT IN ( 'Completed','InProcess') AND blng__PaymentBatch__c != 'Refund - Skip Payment Batch' AND blng_", "atch__c != 'Refund - Skip Payment Batch' AND blng__Account__r.Billing_Enabled__c != null AND Credit_Card_Surcharge_Status__c IN ('Not Applicable','Completed','') and Id='aCldx0000001E2XCAU'\n\nStep 2: Run the payment integration batch via the workbench.\nId batchId = Database.executeBatch(new STCB_PaymentIntegration_Batch(), 1);\n\n\n\n\n\nStep 3: Verify that the invoice status is updated to Paid.\n\n\n6. Refund Process\nStep 1: Initiate a refund:\nClick the New Refund button on the Payment page.\nEnter refund", "ew Refund button on the Payment page.\nEnter refund details such as date, cash/credit type, and refund type.\nSave the refund.\n\nStep 2: Verify refund details:\nCheck the refund date, status, and amount on the Refund page.\n\nStep 3: Edit refund lines:\nClick Add/Edit Refund Lines and make necessary changes.\nValidate the updates on the Refund Summary page.\nConfirm additional parameters such as surcharge and tax.\n\n\n7. Test Case Scenarios\nRefunds based on:  \nQuantity or Amount. \nWith/Without Tax.\nIncludi", ":  \nQuantity or Amount. \nWith/Without Tax.\nIncluding/Excluding Surcharge.\nPerform partial or full refunds based on the requirements.\n\n\n8. Final Verification\nStep 1: Verify that the refund is successfully posted.\n\nStep 2: Confirm the refund amount and status (Draft) on the details page.\n\n\n"]